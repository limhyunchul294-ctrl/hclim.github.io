<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reference Clone – GSW-like UI (UI Only)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // ===== Brand (customizable) =====
    window.__BRAND__ = {
      name: "EVKMC A/S",
      primary: "#374151",
      accent: "#9CA3AF",
      dark: "#111827",
      light: "#F3F4F6",
      logoUrl: "./assets/evkmc-logo.png"
    };
    
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              DEFAULT: window.__BRAND__.primary,
              accent: window.__BRAND__.accent,
              dark: window.__BRAND__.dark,
              light: window.__BRAND__.light
            }
          },
          boxShadow: { soft: "0 10px 30px rgba(0,0,0,.06)" },
          borderRadius: { '2xl': '1rem', '3xl': '1.25rem' }
        }
      }
    }
  </script>
  <style>
    html, body { height: 100%; }
    body { overflow-x: hidden; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; }
    .x-anim { transition: all .2s ease; }
    
    /* 네비게이션 스무스 전환 */
    .nav-link { 
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #374151, #9CA3AF);
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1px;
    }
    
    .nav-link:hover::after {
      width: 100%;
    }
    
    .nav-active { 
      color: #111827; 
    }
    
    .nav-active::after {
      width: 100%;
    }
    
    /* 아이콘 애니메이션 */
    .nav-icon {
      transition: transform 0.2s ease;
    }
    
    .nav-link:hover .nav-icon {
      transform: scale(1.1);
    }
    
    .nav-active .nav-icon {
      transform: scale(1.1);
    }
    
    /* 페이지 전환 애니메이션 */
    .page-transition {
      animation: fadeInUp 0.4s ease-out;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* 버튼 호버 효과 개선 */
    .btn-primary {
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .btn-primary:hover::before {
      left: 100%;
    }
    
    /* 토스트 알림 시스템 */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      pointer-events: none;
    }
    
    .toast {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 8px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 8px;
      pointer-events: auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      max-width: 300px;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      border-left: 4px solid #10b981;
    }
    
    .toast.error {
      border-left: 4px solid #ef4444;
    }
    
    .toast.info {
      border-left: 4px solid #3b82f6;
    }
    
    /* 스켈레톤 로딩 */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 4px;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .skeleton-text {
      height: 16px;
      margin-bottom: 8px;
    }
    
    .skeleton-button {
      height: 32px;
      width: 80px;
      border-radius: 8px;
    }
    
    /* 로딩 스피너 */
    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid #374151;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* 필터 칩 */
    .filter-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 16px;
      padding: 4px 12px;
      font-size: 12px;
      color: #374151;
      transition: all 0.2s ease;
    }
    
    .filter-chip:hover {
      background: #e5e7eb;
    }
    
    .filter-chip .remove {
      cursor: pointer;
      padding: 2px;
      border-radius: 50%;
      transition: background 0.2s ease;
    }
    
    .filter-chip .remove:hover {
      background: #d1d5db;
    }
    
    /* 검색 제안 드롭다운 */
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-top: none;
      border-radius: 0 0 12px 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      z-index: 1000;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .suggestion-item {
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .suggestion-item:hover {
      background: #f9fafb;
    }
    
    .suggestion-item.active {
      background: #f3f4f6;
    }
    
    /* 트리 컴포넌트 스타일 */
    .tree-item {
      position: relative;
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 6px;
      margin: 1px 0;
    }
    
    .tree-item:hover {
      background: #f9fafb;
      transform: translateX(2px);
    }
    
    .tree-item.active {
      background: #f3f4f6;
      border-left: 3px solid #3b82f6;
    }
    
    .tree-item.active .tree-content {
      background: rgba(59, 130, 246, 0.1);
    }
    
    .tree-item.active:hover {
      background: #f3f4f6;
      transform: translateX(2px);
    }
    
    .tree-toggle {
      width: 16px;
      height: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease;
      margin-right: 8px;
    }
    
    .tree-toggle.expanded {
      transform: rotate(90deg);
    }
    
    .tree-content {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      font-size: 14px;
      color: #374151;
      border-radius: 6px;
      transition: background-color 0.2s ease;
    }
    
    .tree-content:hover {
      background: rgba(59, 130, 246, 0.05);
    }
    
    .tree-children {
      margin-left: 20px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }
    
    .tree-children.collapsed {
      max-height: 0;
    }
    
    .tree-children.expanded {
      max-height: 1000px;
    }
    
    .tree-icon {
      width: 16px;
      height: 16px;
      margin-right: 8px;
      opacity: 0.6;
    }
    
    .tree-badge {
      background: #e5e7eb;
      color: #6b7280;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: auto;
      font-weight: 500;
    }
    
    .tree-badge.new {
      background: #dcfce7;
      color: #166534;
    }
    
    .tree-badge.updated {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-indicator {
      font-size: 9px;
      padding: 1px 4px;
      border-radius: 6px;
      margin-left: 4px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .status-indicator.new {
      background: #dcfce7;
      color: #166534;
    }
    
    .status-indicator.updated {
      background: #fef3c7;
      color: #92400e;
    }
    
    .tree-item.new .tree-label {
      font-weight: 600;
      color: #166534;
    }
    
    .tree-item.updated .tree-label {
      font-weight: 600;
      color: #92400e;
    }
    
    /* 트리 선택 애니메이션 */
    @keyframes treeItemSelect {
      0% { background-color: #f3f4f6; }
      50% { background-color: #e5e7eb; }
      100% { background-color: #f3f4f6; }
    }
    
    /* 트리 토글 애니메이션 개선 */
    .tree-toggle {
      transition: transform 0.2s ease;
    }
    
    .tree-toggle.expanded {
      transform: rotate(90deg);
    }
    
    /* 트리 아이템 호버 효과 개선 */
    .tree-item:hover .tree-content {
      background: rgba(59, 130, 246, 0.05);
    }
    
    .tree-item.active:hover .tree-content {
      background: rgba(59, 130, 246, 0.1);
    }
    
    .tree-search {
      position: relative;
      margin-bottom: 12px;
    }
    
    .tree-search input {
      width: 100%;
      padding: 6px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 12px;
    }
    
    .tree-search input:focus {
      outline: none;
      border-color: #374151;
      box-shadow: 0 0 0 2px rgba(55, 65, 81, 0.1);
    }
  </style>
</head>
<body class="bg-brand-light text-slate-800">
  <!-- 토스트 알림 컨테이너 -->
  <div id="toast-container" class="toast-container"></div>
  
  <!-- Top strip -->
  <div class="bg-white border-b border-slate-200 text-sm">
    <div class="mx-auto max-w-7xl px-4 py-2 flex items-center justify-between">
      <span class="text-slate-600">이 페이지는 <strong class="text-slate-900">UI 전용 레퍼런스 클론</strong>입니다. 실제 서버/데이터는 없습니다.</span>
      <span class="text-slate-500">정적 파일 1개로 배포 가능</span>
    </div>
  </div>

  <!-- Header / Nav -->
  <header class="bg-white border-b border-slate-200 sticky top-0 z-40">
    <div class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="w-11 h-11 rounded-2xl bg-brand/10 grid place-items-center overflow-hidden">
          <img id="brand-logo" alt="EVKMC A/S" class="hidden w-11 h-11 object-contain"/>
          <svg id="brand-fallback" width="26" height="26" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 5h10a3 3 0 013 3v11H7a3 3 0 01-3-3V5z" stroke="#374151" stroke-width="2"/>
            <path d="M12 8l7 7" stroke="#374151" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <a href="#/home" class="brand-name text-xl md:text-2xl font-semibold tracking-tight">EVKMC A/S</a>
      </div>
      <nav class="hidden md:flex items-center gap-7 text-[15px]">
        <a data-link href="#/shop" class="nav-link text-slate-600 hover:text-slate-900 pb-2">
          <svg class="nav-icon w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          정비지침서
        </a>
        <a data-link href="#/etm" class="nav-link text-slate-600 hover:text-slate-900 pb-2">
          <svg class="nav-icon w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 3c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 21c0-1 1-2 2-2s2 1 2 2-1 2-2 2-2-1-2-2z" stroke="currentColor" stroke-width="2"/>
          </svg>
          전장회로도
        </a>
        <a data-link href="#/dtc" class="nav-link text-slate-600 hover:text-slate-900 pb-2">
          <svg class="nav-icon w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="9" x2="12" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          DTC 매뉴얼
        </a>
        <a data-link href="#/body" class="nav-link text-slate-600 hover:text-slate-900 pb-2">
          <svg class="nav-icon w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="9" cy="9" r="2" stroke="currentColor" stroke-width="2"/>
            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          차체매뉴얼
        </a>
        <a data-link href="#/wiring" class="nav-link text-slate-600 hover:text-slate-900 pb-2">
          <svg class="nav-icon w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          와이어링 커넥터
        </a>
      </nav>
      <div class="flex items-center gap-4">
        <div id="auth-buttons" class="flex items-center gap-4">
          <button id="open-login" class="px-3 py-1.5 rounded-xl bg-white border border-slate-300 hover:border-slate-400 x-anim flex items-center gap-2">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <polyline points="10,17 15,12 10,7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="15" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            로그인
          </button>
          <button id="open-signup" class="px-3 py-1.5 rounded-xl bg-brand-dark text-white hover:opacity-90 x-anim btn-primary flex items-center gap-2">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="8.5" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
              <line x1="20" y1="8" x2="20" y2="14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <line x1="23" y1="11" x2="17" y2="11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            무료 시작
          </button>
        </div>
        <div id="user-menu" class="hidden items-center gap-4">
          <span id="user-name" class="text-sm font-medium"></span>
          <button id="logout-btn" class="px-3 py-1.5 rounded-xl bg-white border border-slate-300 hover:border-slate-400 x-anim">로그아웃</button>
        </div>
        <button id="mobile-menu-btn" class="md:hidden p-2 rounded-xl border border-slate-300 hover:bg-slate-50 transition-colors" aria-expanded="false" aria-controls="mobile-nav">
          <span class="sr-only">메뉴</span>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
    <div id="mobile-nav" class="md:hidden hidden border-t border-slate-200 bg-white">
      <div class="px-4 py-2 flex flex-col gap-2 text-sm">
        <a data-link href="#/shop" class="py-2 flex items-center gap-3 hover:bg-slate-50 rounded-lg px-2 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          정비지침서
        </a>
        <a data-link href="#/etm" class="py-2 flex items-center gap-3 hover:bg-slate-50 rounded-lg px-2 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12c-1 0-2-1-2-2s1-2 2-2 2 1 2 2-1 2-2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M3 12c1 0 2-1 2-2s-1-2-2-2-2 1-2 2 1 2 2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 3c0 1-1 2-2 2s-2-1-2-2 1-2 2-2 2 1 2 2z" stroke="currentColor" stroke-width="2"/>
            <path d="M12 21c0-1 1-2 2-2s2 1 2 2-1 2-2 2-2-1-2-2z" stroke="currentColor" stroke-width="2"/>
          </svg>
          전장회로도
        </a>
        <a data-link href="#/dtc" class="py-2 flex items-center gap-3 hover:bg-slate-50 rounded-lg px-2 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="9" x2="12" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          DTC 매뉴얼
        </a>
        <a data-link href="#/body" class="py-2 flex items-center gap-3 hover:bg-slate-50 rounded-lg px-2 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="9" cy="9" r="2" stroke="currentColor" stroke-width="2"/>
            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          차체매뉴얼
        </a>
        <a data-link href="#/wiring" class="py-2 flex items-center gap-3 hover:bg-slate-50 rounded-lg px-2 transition-colors">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          와이어링 커넥터
        </a>
      </div>
    </div>
  </header>

  <main id="app" class="mx-auto max-w-7xl px-4 py-8 transition-all duration-300 ease-out"></main>

  <footer class="mt-16 bg-slate-800 text-slate-200">
    <div class="mx-auto max-w-7xl px-4 py-12 grid md:grid-cols-2 gap-8">
      <div>
        <div class="text-lg font-semibold mb-4">(주)이브이케이엠씨</div>
        <ul class="space-y-1 text-sm">
          <li>대표 : 류강식</li>
          <li>사업자등록번호 : 847-86-01815</li>
          <li>주소 : 서울시 강남구 도곡로 23길 23길 (역삼동) 1층 EVKMC</li>
          <li>대표전화 : 02-553-9866</li>
        </ul>
        <div class="mt-6 text-xs text-slate-400">Copyright© <span id="year"></span> (주)이브이케이엠씨. All rights reserved.</div>
        <a href="#/privacy" class="mt-3 inline-block text-xs underline underline-offset-2">개인정보처리방침</a>
      </div>
      <div class="grid grid-cols-2 gap-6">
        <div>
          <div class="font-semibold mb-4">페이지 바로가기</div>
          <ul class="space-y-2 text-sm">
            <li><a href="#" class="hover:text-white">구매문의</a></li>
            <li><a href="#" class="hover:text-white">정비네트워크</a></li>
            <li><a href="#" class="hover:text-white">부품구매문의</a></li>
            <li><a href="#" class="hover:text-white">공지사항</a></li>
          </ul>
        </div>
        <div>
          <div class="font-semibold mb-4">바로가기</div>
          <ul class="space-y-2 text-sm">
            <li><a href="#" class="hover:text-white">Youtube<span class="ml-1">↗</span></a></li>
            <li><a href="#" class="hover:text-white">Blog<span class="ml-1">↗</span></a></li>
            <li><a href="#" class="hover:text-white">Instagram<span class="ml-1">↗</span></a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <!-- Auth Modals (UI only) -->
  <div id="login-modal" class="fixed inset-0 hidden bg-black/40 backdrop-blur-sm items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-soft max-w-md w-full p-6 relative">
      <button data-close class="absolute top-3 right-3 p-2 rounded-lg hover:bg-slate-100">
        <span class="sr-only">닫기</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 6l12 12M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <h2 class="text-xl font-semibold mb-2">로그인 (UI 전용)</h2>
      <p class="text-sm text-slate-600 mb-6">제출 시 더미 세션이 생성됩니다. 서버 통신 없음.</p>
      <form id="login-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">이메일</label>
          <input name="email" type="email" required class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-dark" placeholder="you@example.com" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">비밀번호</label>
          <input name="password" type="password" required class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-dark" placeholder="••••••••" />
        </div>
        <button class="w-full py-2.5 rounded-xl bg-brand-dark text-white hover:opacity-90">로그인</button>
      </form>
    </div>
  </div>

  <div id="signup-modal" class="fixed inset-0 hidden bg-black/40 backdrop-blur-sm items-center justify-center p-4">
    <div class="bg-white rounded-3xl shadow-soft max-w-md w-full p-6 relative">
      <button data-close class="absolute top-3 right-3 p-2 rounded-lg hover:bg-slate-100">
        <span class="sr-only">닫기</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 6l12 12M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <h2 class="text-xl font-semibold mb-2">무료 시작 (UI 전용)</h2>
      <p class="text-sm text-slate-600 mb-6">입력값은 로컬 스토리지에만 저장됩니다.</p>
      <form id="signup-form" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">이름</label>
          <input name="name" required class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-dark" placeholder="홍길동" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">이메일</label>
          <input name="email" type="email" required class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-dark" placeholder="you@example.com" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">비밀번호</label>
          <input name="password" type="password" minlength="6" required class="w-full px-3 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-brand-dark" placeholder="6자 이상" />
        </div>
        <button class="w-full py-2.5 rounded-xl bg-brand-dark text-white hover:opacity-90">계정 만들기</button>
      </form>
    </div>
  </div>

  <!-- Inline dummy parts DB (offline) -->
  <script type="application/json" id="parts-db">
  [
    {
      "partNo": "37512-MA200",
      "nameKo": "BMS 모듈",
      "aliases": ["37512MA200","BMS"],
      "models": ["masada-2van","masada-4van"],
      "yearFrom": 2022,
      "yearTo": 9999,
      "chem": ["LFP","NCM"],
      "category": "전기",
      "subCategory": "배터리 시스템",
      "keywords": ["BMS","배터리","HV"],
      "diagramRef": {"pdf":"assets/pdfs/2024-etm-bms.pdf","page":12}
    },
    {
      "partNo": "92123-MC100",
      "nameKo": "배터리 팩, LFP",
      "aliases": ["92123MC100"],
      "models": ["masada-cargo"],
      "yearFrom": 2023,
      "yearTo": 9999,
      "chem": ["LFP"],
      "category": "전기",
      "subCategory": "고전압 배터리",
      "keywords": ["Pack","LFP","HV"]
    }
  ]
  </script>

  <script>
  // ============ SPA Core ============
  if (window.__APP_INIT__) {
    console.warn('App already initialized – skipping duplicate script execution');
  } else {
    window.__APP_INIT__ = true;
    (function(){
      // ---- Constants / helpers ----
      const MODELS = [
        { value: 'masada-2van', label: 'MASADA 2VAN' },
        { value: 'masada-4van', label: 'MASADA 4VAN' },
        { value: 'masada-cargo', label: 'MASADA Cargo(Pick-up)' },
      ];
      function yearsFrom(start = 2022) {
        const y = new Date().getFullYear();
        return Array.from({length: y - start + 1}, (_,i)=> (start + i));
      }
      const app = document.getElementById('app');

      function debounce(func, delay) {
        let timeout;
        return function(...args) {
          const context = this;
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(context, args), delay);
        };
      }

      // ---- Router ----
      const routes = {
        '/home': renderHome,
        '/shop': () => renderSection('정비지침서'),
        '/etm': () => renderSection('전장회로도'),
        '/dtc': () => renderSection('DTC 매뉴얼'),
        '/body': () => renderSection('차체매뉴얼'),
        '/wiring': () => renderSection('와이어링 커넥터'),
        '/privacy': renderPrivacy,
      };
      function navigate(path) { window.location.hash = `#${path}`; }
      function router() {
        const hash = window.location.hash.replace('#','') || '/home';
        
        // 페이지 전환 애니메이션
        const app = document.getElementById('app');
        if (app) {
          app.style.opacity = '0';
          app.style.transform = 'translateY(20px)';
          
          setTimeout(() => {
            (routes[hash]||renderNotFound)();
            highlightNav(hash);
            if (hash !== '/home') setupPdfViewer();
            
            // 애니메이션 복원
            app.style.opacity = '1';
            app.style.transform = 'translateY(0)';
            app.classList.add('page-transition');
            
            setTimeout(() => {
              app.classList.remove('page-transition');
            }, 400);
          }, 150);
        } else {
        (routes[hash]||renderNotFound)();
        highlightNav(hash);
        if (hash !== '/home') setupPdfViewer();
        }
      }
      function highlightNav(hash){
        document.querySelectorAll('.nav-link').forEach(a=>{
          const to=(a.getAttribute('href')||'').replace('#','');
          a.classList.toggle('nav-active', to===hash);
        });
      }

      // 토스트 알림 시스템
      function showToast(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
        
        toast.innerHTML = `
          <span>${icon}</span>
          <span>${message}</span>
        `;
        
        container.appendChild(toast);
        
        // 애니메이션 시작
        setTimeout(() => toast.classList.add('show'), 100);
        
        // 자동 제거
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => container.removeChild(toast), 300);
        }, duration);
      }
      
      // 스켈레톤 로딩 HTML 생성
      function skeletonLoadingHTML() {
        return `
          <div class="space-y-3">
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text" style="width: 80%;"></div>
            <div class="skeleton skeleton-text" style="width: 60%;"></div>
            <div class="flex gap-2">
              <div class="skeleton skeleton-button"></div>
              <div class="skeleton skeleton-button"></div>
            </div>
          </div>
        `;
      }
      
      // 검색 제안 기능
      function setupSearchSuggestions() {
        const searchInput = document.getElementById('part-q');
        const suggestionsContainer = document.getElementById('search-suggestions');
        
        if (!searchInput || !suggestionsContainer) return;
        
        let suggestions = [
          '배터리 팩', '모터', '인버터', '충전기', 'BMS', '컨트롤러',
          'LFP', 'NCM', '92123-MC100', 'MASADA', '2VAN', '4VAN', 'Cargo'
        ];
        
        let currentSuggestions = [];
        let selectedIndex = -1;
        
        const debouncedSuggestionSearch = debounce((query) => {
          if (query.length < 2) {
            suggestionsContainer.classList.add('hidden');
            return;
          }
          // 검색 제안 필터링
          currentSuggestions = suggestions.filter(s => 
            s.toLowerCase().includes(query.toLowerCase())
          ).slice(0, 5);
          
          if (currentSuggestions.length > 0) {
            renderSuggestions();
            suggestionsContainer.classList.remove('hidden');
          } else {
            suggestionsContainer.classList.add('hidden');
          }
        }, 300);

        searchInput.addEventListener('input', (e) => {
          debouncedSuggestionSearch(e.target.value.trim());
        });
        
        searchInput.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowDown') {
            e.preventDefault();
            selectedIndex = Math.min(selectedIndex + 1, currentSuggestions.length - 1);
            updateSuggestionSelection();
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            selectedIndex = Math.max(selectedIndex - 1, -1);
            updateSuggestionSelection();
          } else if (e.key === 'Enter') {
            e.preventDefault();
            if (selectedIndex >= 0) {
              searchInput.value = currentSuggestions[selectedIndex];
              suggestionsContainer.classList.add('hidden');
              // 검색 실행
              performSearch();
            }
          } else if (e.key === 'Escape') {
            suggestionsContainer.classList.add('hidden');
          }
        });
        
        // 검색 제안 클릭
        suggestionsContainer.addEventListener('click', (e) => {
          const item = e.target.closest('.suggestion-item');
          if (item) {
            const index = parseInt(item.dataset.index);
            searchInput.value = currentSuggestions[index];
            suggestionsContainer.classList.add('hidden');
            performSearch();
          }
        });
        
        // 포커스 아웃 시 제안 숨기기
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
            suggestionsContainer.classList.add('hidden');
          }
        });
        
        function renderSuggestions() {
          suggestionsContainer.innerHTML = currentSuggestions.map((suggestion, index) => `
            <div class="suggestion-item ${index === selectedIndex ? 'active' : ''}" data-index="${index}">
              ${suggestion}
            </div>
          `).join('');
        }
        
        function updateSuggestionSelection() {
          const items = suggestionsContainer.querySelectorAll('.suggestion-item');
          items.forEach((item, index) => {
            item.classList.toggle('active', index === selectedIndex);
          });
        }
      }
      
      // 필터 칩 관리
      function updateActiveFilters() {
        const activeFiltersContainer = document.getElementById('active-filters');
        if (!activeFiltersContainer) return;
        
        const modelSelect = document.getElementById('modelSelect');
        const yearSelect = document.getElementById('yearSelect');
        const chemistrySelect = document.getElementById('chemistrySelect');
        const searchInput = document.getElementById('part-q');
        
        const filters = [];
        
        if (modelSelect && modelSelect.value) {
          const selectedOption = modelSelect.options[modelSelect.selectedIndex];
          filters.push({
            type: 'model',
            label: selectedOption.text,
            value: modelSelect.value
          });
        }
        
        if (yearSelect && yearSelect.value) {
          filters.push({
            type: 'year',
            label: `${yearSelect.value}년`,
            value: yearSelect.value
          });
        }
        
        if (chemistrySelect && chemistrySelect.value) {
          filters.push({
            type: 'chemistry',
            label: chemistrySelect.value,
            value: chemistrySelect.value
          });
        }
        
        if (searchInput && searchInput.value.trim()) {
          filters.push({
            type: 'search',
            label: `"${searchInput.value.trim()}"`,
            value: searchInput.value.trim()
          });
        }
        
        activeFiltersContainer.innerHTML = filters.map(filter => `
          <div class="filter-chip" data-type="${filter.type}" data-value="${filter.value}">
            <span>${filter.label}</span>
            <span class="remove" onclick="removeFilter('${filter.type}')">×</span>
          </div>
        `).join('');
      }
      
      // 필터 제거
      function removeFilter(type) {
        switch (type) {
          case 'model':
            document.getElementById('modelSelect').value = '';
            break;
          case 'year':
            document.getElementById('yearSelect').value = '';
            break;
          case 'chemistry':
            document.getElementById('chemistrySelect').value = '';
            break;
          case 'search':
            document.getElementById('part-q').value = '';
            break;
        }
        updateActiveFilters();
        performSearch();
      }
      
      // 필터 초기화
      function clearAllFilters() {
        const modelSelect = document.getElementById('modelSelect');
        const yearSelect = document.getElementById('yearSelect');
        const chemistrySelect = document.getElementById('chemistrySelect');
        const searchInput = document.getElementById('part-q');
        
        if (modelSelect) modelSelect.value = '';
        if (yearSelect) yearSelect.value = '';
        if (chemistrySelect) chemistrySelect.value = '';
        if (searchInput) searchInput.value = '';
        
        updateActiveFilters();
        performSearch();
        showToast('모든 필터가 초기화되었습니다.', 'info');
      }
      
      // 검색 실행 (로딩 상태 포함)
      function performSearch() {
        const searchBtn = document.getElementById('part-search-btn');
        const resultsContainer = document.getElementById('part-results');
        
        if (searchBtn) {
          // 로딩 상태 표시
          searchBtn.innerHTML = '<div class="spinner"></div>';
          searchBtn.disabled = true;
        }
        
        if (resultsContainer) {
          resultsContainer.innerHTML = skeletonLoadingHTML();
        }
        
        // 실제 검색 로직 (시뮬레이션)
        setTimeout(() => {
          if (searchBtn) {
            searchBtn.innerHTML = '<span>조회</span>';
            searchBtn.disabled = false;
          }
          
          // 검색 결과 표시
          const query = document.getElementById('part-q')?.value || '';
          if (query.trim()) {
            showToast(`"${query}" 검색 결과를 찾았습니다.`, 'success');
          }
          
          // 실제 검색 결과 렌더링
          if (resultsContainer) {
            // 기존 검색 로직 호출
            const parts = loadParts().then(partsData => {
              const selection = {
                model: document.getElementById('modelSelect')?.value || '',
                year: parseInt(document.getElementById('yearSelect')?.value) || 2024,
                chem: document.getElementById('chemistrySelect')?.value || 'LFP'
              };
              const results = searchParts(partsData, query, selection);
              renderPartResults(results);
            });
          }
        }, 1000);
      }
      
      // 연식에 따른 배터리 화학 성분 자동 설정
      function updateChemistryByYear(year) {
        const chemistrySelect = document.getElementById('chemistrySelect');
        if (!chemistrySelect) return;
        
        let chemistry = 'LFP'; // 기본값
        if (year >= 2025) {
          chemistry = 'NCM';
        }
        
        chemistrySelect.value = chemistry;
        
        // 배터리 체크박스도 업데이트
        const batteryChecks = document.getElementById('batteryChecks');
        if (batteryChecks) {
          const checkboxes = batteryChecks.querySelectorAll('input[type="checkbox"]');
          checkboxes.forEach((checkbox, index) => {
            const isLFP = checkbox.parentElement.textContent.includes('LFP');
            const isNCM = checkbox.parentElement.textContent.includes('NCM');
            
            if (chemistry === 'LFP' && isLFP) {
              checkbox.checked = true;
            } else if (chemistry === 'NCM' && isNCM) {
              checkbox.checked = true;
            } else {
              checkbox.checked = false;
            }
          });
        }
        
        // 필터 칩 업데이트
        updateActiveFilters();
      }

      // ---- Local storage (UI-only) ----
      const SESSION_KEY = 'demo_session_v1';
      const USERS_KEY = 'demo_users_v1';
      const session = { get(){return JSON.parse(localStorage.getItem(SESSION_KEY)||'null')}, set(v){localStorage.setItem(SESSION_KEY, JSON.stringify(v))}, clear(){localStorage.removeItem(SESSION_KEY)} };
      const users   = { all(){return JSON.parse(localStorage.getItem(USERS_KEY)||'[]')}, add(u){localStorage.setItem(USERS_KEY, JSON.stringify([...this.all(),u]))}, findByEmail(e){return this.all().find(u=>u.email===e)} };
      function requireAuthUI(){ const s=session.get(); if(!s){ return `<div class="bg-white border border-slate-200 rounded-3xl p-8 text-center">
          <h3 class=\"text-lg font-semibold mb-2\">로그인이 필요합니다 (UI 전용)</h3>
          <p class=\"text-slate-600 mb-6\">실제 인증은 없으며, 상단의 <strong>로그인</strong> 또는 <strong>무료 시작</strong> 버튼으로 더미 세션을 만드세요.</p>
          <div class=\"flex items-center justify-center gap-3\"><button class=\"px-4 py-2 rounded-xl border\" onclick=\"openLogin()\">로그인</button><button class=\"px-4 py-2 rounded-xl bg-brand-dark text-white\" onclick=\"openSignup()\">무료 시작</button></div>
        </div>`;} return ''; }

      // ---- UI blocks ----
      function filterBarHTML(includeCheckboxes=true){
        const yearOpts = yearsFrom(2022).map(y=>`<option value="${y}">${y}</option>`).join('');
        const modelOpts = MODELS.map(m=>`<option value="${m.value}">${m.label}</option>`).join('');
        // IMPORTANT: IDs unified with part-search (part-q / part-search-btn)
        return `
          <div class="bg-white border border-slate-200 rounded-3xl p-4 md:p-5">
            <form id="filterForm" class="grid gap-4 md:grid-cols-5 items-end">
              <div>
                <label class="block text-xs text-slate-500 mb-1">차종</label>
                <select id="modelSelect" class="w-full h-11 border rounded-xl px-3">${modelOpts}</select>
              </div>
              <div>
                <label class="block text-xs text-slate-500 mb-1">연식</label>
                <select id="yearSelect" class="w-full h-11 border rounded-xl px-3">${yearOpts}</select>
              </div>
              <div>
                <label class="block text-xs text-slate-500 mb-1">배터리</label>
                <select id="chemistrySelect" class="w-full h-11 border rounded-xl px-3">
                  <option value="LFP">LFP</option>
                  <option value="NCM">NCM</option>
                </select>
              </div>
              <div class="md:col-span-2 relative">
                <label class="block text-xs text-slate-500 mb-1">키워드 / 부품번호</label>
                <div class="flex gap-2">
                  <div class="relative flex-1">
                  <input id="part-q" class="w-full h-11 border rounded-xl px-3" placeholder="부품명, 키워드…" />
                    <div id="search-suggestions" class="search-suggestions hidden"></div>
                  </div>
                  <button id="part-search-btn" type="button" class="h-11 px-4 rounded-xl border bg-white shrink-0 flex items-center gap-2">
                    <span>조회</span>
                  </button>
                </div>
              </div>
            </form>
            <div class="mt-4 flex items-center justify-between">
            ${ includeCheckboxes ? `
              <div id="batteryChecks" class="flex flex-wrap gap-4 text-sm text-slate-700">
              <label class="inline-flex items-center gap-2"><input type="checkbox" checked> LFP</label>
              <label class="inline-flex items-center gap-2"><input type="checkbox" checked> NCM</label>
              </div>` : '<div></div>'}
              <button id="clear-filters" type="button" class="text-xs text-slate-500 hover:text-slate-700 px-2 py-1 rounded">
                필터 초기화
              </button>
            </div>
            <div id="active-filters" class="mt-3 flex flex-wrap gap-2"></div>
          </div>`;
      }

      function pdfViewerHTML(){
        return `
          <div class=\"bg-white border border-slate-200 rounded-2xl overflow-hidden\">\n              <div class=\"flex items-center justify-between px-4 py-3 border-b\">\n                <div class=\"flex items-center gap-2 text-sm\">\n                  <button id=\"btn-open-pdf\" class=\"px-3 py-1.5 rounded-lg border\">PDF 열기</button>\n                  <input id=\"pdf-file\" type=\"file\" accept=\"application/pdf\" class=\"hidden\" />\n                  <button id=\"btn-clear-pdf\" class=\"px-3 py-1.5 rounded-lg border\">지우기</button>\n                </div>\n                <div class=\"text-xs text-slate-500\">드래그&드롭 지원</div>\n              </div>\n              <div id=\"pdf-dropzone\" class=\"relative h-[560px]\">\n                <iframe id=\"pdfFrame\" title=\"PDF viewer\" class=\"absolute inset-0 w-full h-full\" src=\"\"></iframe>\n                <div id=\"pdf-placeholder\" class=\"absolute inset-0 grid place-items-center text-slate-400\">\n                  PDF/SVG 자리 — 'PDF 열기'로 파일을 선택하거나 여기에 드래그하세요.\n                </div>\n              </div>\n              <div class=\"px-4 py-3 border-t\">\n                <div class=\"text-xs text-slate-500 mb-2\">최근 열람(브라우저 저장)</div>\n                <div id=\"recent-pdfs\" class=\"flex flex-wrap gap-2\"></div>\n              </div>\n            </div>`;
      }

      function quickLinkTableHTML(){
        const ys = yearsFrom(2022).reverse();
        return `
          <div class=\"bg-white border border-slate-200 rounded-3xl p-0 overflow-hidden\">\n            <div class=\"px-5 py-4 font-semibold border-b\">Quick Link</div>\n            <div class=\"overflow-x-auto\">\n              <table class=\"min-w-full text-sm\">\n                <thead class=\"bg-slate-50\">\n                  <tr class=\"text-left text-slate-600\">\n                    <th class=\"py-2 px-4 w-28\">연식</th>\n                    <th class=\"py-2 px-4\">정비지침서(SHOP)</th>\n                    <th class=\"py-2 px-4\">차체매뉴얼(BODY)</th>\n                    <th class=\"py-2 px-4\">전장회로도(ETM)</th>\n                    <th class=\"py-2 px-4\">DTC 매뉴얼</th>\n                    <th class=\"py-2 px-4\">특수공구(SST)</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  ${ys.map(y=>`\n                    <tr class=\"border-t\">\n                      <td class=\"py-2 px-4 text-slate-700\">${y}</td>\n                      <td class=\"py-2 px-4\"><button class=\"px-2 py-1 rounded-lg border\">보기</button></td>\n                      <td class=\"py-2 px-4\"><button class=\"px-2 py-1 rounded-lg border\">보기</button></td>\n                      <td class=\"py-2 px-4\"><button class=\"px-2 py-1 rounded-lg border\">보기</button></td>\n                      <td class=\"py-2 px-4\"><button class=\"px-2 py-1 rounded-lg border\">보기</button></td>\n                      <td class=\"py-2 px-4\"><button class=\"px-2 py-1 rounded-lg border\">보기</button></td>\n                    </tr>`).join('')}\n                </tbody>\n              </table>\n            </div>\n          </div>`;
      }

      // --- Left panel (Parts quick search + clipboard mode) ---
      function leftPanelHTML(){
        return `
        <aside class=\"bg-white border border-slate-200 rounded-3xl p-4 space-y-4\">\n          <div class=\"font-semibold\">부품 간단검색</div>\n          <div class=\"space-y-2\">\n            <input id=\"part-q\" class=\"w-full h-11 border rounded-xl px-3\" placeholder=\"부품번호/이름/키워드\" />\n            <div class=\"flex gap-2\">\n              <button id=\"part-search-btn\" class=\"px-3 py-2 rounded-xl border\">검색</button>\n              <label class=\"inline-flex items-center gap-2 text-xs text-slate-600\"><input id=\"part-copy-mode\" type=\"checkbox\"/> 클릭 시 복사모드</label>\n            </div>\n          </div>\n          <div id=\"part-results\" class=\"border rounded-xl divide-y\"></div>\n          <div class=\"pt-3 border-t mt-3\">\n            <div class=\"text-xs text-slate-500 mb-1\">CSV 불러오기(오프라인)</div>\n            <div class=\"flex gap-2\">\n              <button id=\"part-csv-btn\" class=\"px-2.5 py-1.5 border rounded-lg text-xs\">CSV 선택</button>\n              <input id=\"parts-csv-file\" type=\"file\" accept=\".csv\" class=\"hidden\" />\n            </div>\n          </div>\n        </aside>`
      }

      // === Parts search helpers ===
      async function loadParts(){
        try{ const cached = localStorage.getItem('partsDB'); if (cached) return JSON.parse(cached); }catch(e){}
        const inline = document.getElementById('parts-db');
        if (inline) { try { return JSON.parse(inline.textContent); } catch(e){} }
        try{ const res = await fetch('assets/data/parts.json'); if (res.ok) return await res.json(); }catch(e){}
        return [];
      }
      const norm = s => String(s||'').replace(/[\s-]/g,'').toLowerCase();
      function filterBySelection(row, sel){
        const okModel = !row.models || row.models.includes(sel.model);
        const okYear  = (!row.yearFrom || sel.year >= row.yearFrom) && (!row.yearTo || sel.year <= row.yearTo);
        const okChem  = !row.chem || row.chem.includes(sel.chem);
        return okModel && okYear && okChem;
      }
      function scoreRow(r, q, nQ){
        const pn = norm(r.partNo||'');
        const aliases = (r.aliases||[]).map(norm);
        const name = (r.nameKo||'');
        const keystr = (r.keywords||[]).join('|');
        if (!q) return 1;
        let s = -1;
        if (name.toLowerCase().includes(q.toLowerCase())) s = Math.max(s, 90);
        if (keystr.toLowerCase().includes(q.toLowerCase())) s = Math.max(s, 80);
        if (pn && pn === nQ) s = Math.max(s, 95);
        if (aliases.includes(nQ)) s = Math.max(s, 85);
        if ((r.partNo||'').toLowerCase().includes(q.toLowerCase())) s = Math.max(s, 70);
        return s;
      }
      function searchParts(rows, q, sel){
        const nQ = norm(q);
        const out = [];
        for (const r of rows){ if (!filterBySelection(r, sel)) continue; const s = scoreRow(r, q, nQ); if (s>0) out.push({s, r}); }
        return out.sort((a,b)=>b.s-a.s).slice(0,50).map(x=>x.r);
      }
      function renderPartResults(list){
        const box = document.getElementById('part-results'); if (!box) return;
        if (!list.length){ box.innerHTML = `<div class=\"py-6 text-center text-slate-400 text-sm\">검색 결과 없음</div>`; return; }
        box.innerHTML = list.map(r=>{
          const tag = (arr)=> (arr&&arr.length)? `<span class=\"inline-flex items-center px-1.5 py-0.5 text-[10px] rounded bg-slate-100 border\">${arr.join(',')}</span>` : '';
          const models = tag(r.models||[]);
          const chem   = tag(r.chem||[]);
          const years  = (r.yearFrom? r.yearFrom: '') + (r.yearTo? `~${r.yearTo===9999?'':r.yearTo}` : '');
          const canOpen = r.diagramRef && r.diagramRef.pdf;
          const copyText = `[${r.partNo||''}] ${r.nameKo||''}${r.models?` / ${r.models.join(',')}`:''}${r.chem?` / ${r.chem.join(',')}`:''}${years?` / ${years}`:''}`;
          return `<div class=\"p-2 text-sm flex items-start justify-between gap-2\">\n              <button class=\"flex-1 text-left leading-5 hover:underline\" data-copy=\"${encodeURIComponent(copyText)}\" data-open=\"${canOpen?encodeURIComponent(r.diagramRef.pdf):''}\">\n                <div class=\"font-medium text-slate-900\">[${r.partNo||''}] ${r.nameKo||''}</div>\n                <div class=\"mt-0.5 flex items-center gap-1 text-slate-600\">${models} ${chem} ${years?`<span class=\\"text-[10px] border rounded px-1\\">${years}</span>`:''}</div>\n              </button>\n              <div class=\"flex items-center gap-1\">\n                ${canOpen?`<button class=\"px-2 py-1 border rounded text-[12px]\" data-open-btn data-pdf=\"${encodeURIComponent(r.diagramRef.pdf)}\">열기</button>`:''}\n                <button class=\"px-2 py-1 border rounded text-[12px]\" data-copy-btn data-text=\"${encodeURIComponent(copyText)}\">복사</button>\n              </div>\n            </div>`;
        }).join('');
      }
      function copyToClipboard(text){
        if (navigator.clipboard && navigator.clipboard.writeText){ 
          navigator.clipboard.writeText(text).then(() => {
            showToast('클립보드에 복사되었습니다!', 'success');
          }).catch(() => {
            showToast('복사에 실패했습니다.', 'error');
          });
          return true; 
        }
        const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); 
        try{ 
          document.execCommand('copy'); 
          showToast('클립보드에 복사되었습니다!', 'success');
        } catch(e) {
          showToast('복사에 실패했습니다.', 'error');
        } finally { 
          document.body.removeChild(ta); 
        }
        return true;
      }
      function csvToParts(csv){
        const lines = csv.split(/\r?\n/).filter(Boolean);
        if (!lines.length) return [];
        const hdr = lines[0].split(',').map(h=>h.trim());
        const idx = k => hdr.indexOf(k);
        const list = [];
        for (let i=1;i<lines.length;i++){
          const cols = []; let cur=''; let inq=false; const row=lines[i];
          for (let j=0;j<row.length;j++){
            const c=row[j];
            if (c==='"'){ inq=!inq; continue; }
            if (c===',' && !inq){ cols.push(cur); cur=''; continue; }
            cur+=c;
          }
          cols.push(cur);
          const pick = k => idx(k)>=0 ? (cols[idx(k)]||'').trim() : '';
          const toArr = v => (v? v.split('|').map(s=>s.trim()).filter(Boolean): []);
          const part = {
            partNo: pick('partNo'),
            nameKo: pick('nameKo'),
            aliases: toArr(pick('aliases')),
            models: toArr(pick('models')),
            yearFrom: Number(pick('yearFrom')||'0')||undefined,
            yearTo: Number(pick('yearTo')||'0')||undefined,
            chem: toArr(pick('chem')),
            category: pick('category')||undefined,
            subCategory: pick('subCategory')||undefined,
            keywords: toArr(pick('keywords')),
            supersedes: pick('supersedes')||undefined,
            supersededBy: pick('supersededBy')||undefined,
            relatedParts: toArr(pick('relatedParts')),
            diagramRef: (pick('diagramPdf')||pick('diagramPage')||pick('diagramAnchor')) ? { pdf: pick('diagramPdf')||undefined, page: Number(pick('diagramPage')||'0')||undefined, anchor: pick('diagramAnchor')||undefined } : undefined,
            notes: pick('notes')||undefined,
          };
          if (part.partNo || part.nameKo) list.push(part);
        }
        return list;
      }
      function getSelected(){
        const model = document.getElementById('modelSelect')?.value || 'masada-2van';
        const year  = Number(document.getElementById('yearSelect')?.value || new Date().getFullYear());
        const chem  = document.getElementById('chemistrySelect')?.value || 'LFP';
        return { model, year, chem };
      }
      async function setupPartSearch(){
        const qEl = document.getElementById('part-q');
        const btn = document.getElementById('part-search-btn');
        const csvBtn = document.getElementById('part-csv-btn');
        const csvFile= document.getElementById('parts-csv-file');
        const clearFiltersBtn = document.getElementById('clear-filters');
        
        if (!qEl || !btn) return;
        
        const rows = await loadParts();
        
        // 검색 제안 설정
        setupSearchSuggestions();
        
        // 필터 변경 이벤트
        const modelSelect = document.getElementById('modelSelect');
        const yearSelect = document.getElementById('yearSelect');
        const chemistrySelect = document.getElementById('chemistrySelect');
        
        [modelSelect, yearSelect, chemistrySelect].forEach(el => {
          if (el) {
            el.addEventListener('change', () => {
              updateActiveFilters();
              performSearch();
            });
          }
        });
        
        const debouncedSearch = debounce(() => {
          performSearch();
        }, 500);

        // 검색 입력 이벤트
        qEl.addEventListener('input', () => {
          updateActiveFilters();
          debouncedSearch();
        });
        
        // 검색 버튼 클릭
        btn.onclick = performSearch;
        
        // Enter 키 검색
        qEl.addEventListener('keydown', (e)=>{
          if(e.key==='Enter') {
            e.preventDefault();
            performSearch();
          }
        });
        
        // 필터 초기화 버튼
        if (clearFiltersBtn) {
          clearFiltersBtn.onclick = clearAllFilters;
        }
        
        // 결과 클릭 이벤트
        document.getElementById('part-results')?.addEventListener('click', (e)=>{
          const copyMode = document.getElementById('part-copy-mode')?.checked;
          const openBtn = e.target.closest('[data-open-btn]');
          const copyBtn = e.target.closest('[data-copy-btn]');
          const itemBtn = e.target.closest('button[data-copy]');
          
          if (openBtn){ 
            const p=decodeURIComponent(openBtn.getAttribute('data-pdf')); 
            if (p && window.__openPdfPath) {
              showToast('PDF를 여는 중...', 'info');
              window.__openPdfPath(p); 
            }
            return; 
          }
          
          if (copyBtn){ 
            const t=decodeURIComponent(copyBtn.getAttribute('data-text')); 
            copyToClipboard(t); 
            return; 
          }
          
          if (itemBtn && copyMode){ 
            const t=decodeURIComponent(itemBtn.getAttribute('data-copy')); 
            copyToClipboard(t); 
            return; 
          }
          
          if (itemBtn){ 
            const p=itemBtn.getAttribute('data-open'); 
            if (p){ 
              const pdf=decodeURIComponent(p); 
              if (pdf && window.__openPdfPath) {
                showToast('PDF를 여는 중...', 'info');
                window.__openPdfPath(pdf); 
              }
            } 
          }
        });
        
        // CSV 파일 처리
        if (csvBtn && csvFile){ 
          csvBtn.onclick = ()=> csvFile.click(); 
          csvFile.onchange = (e)=>{ 
            const f=e.target.files?.[0]; 
            if(!f) return; 
            
            showToast('CSV 파일을 처리하는 중...', 'info');
            
            const rd=new FileReader(); 
            rd.onload=()=>{ 
              const text=String(rd.result||''); 
              const arr=csvToParts(text); 
              if (arr.length){ 
                localStorage.setItem('partsDB', JSON.stringify(arr)); 
                showToast(`CSV 불러오기 완료: ${arr.length}건`, 'success');
              } else { 
                showToast('CSV를 읽지 못했습니다. 헤더를 확인하세요.', 'error');
              } 
            }; 
            rd.readAsText(f, 'utf-8'); 
          }; 
        }
        
        // 초기 필터 칩 업데이트
        updateActiveFilters();
      }
      
      // 트리 컴포넌트 생성
      function createTreeHTML(title, data) {
        return `
          <div class="bg-white border border-slate-200 rounded-2xl p-4">
            <div class="flex items-center justify-between mb-3">
              <div class="font-medium">${title}</div>
              <button id="expand-all" class="text-xs text-slate-500 hover:text-slate-700 px-2 py-1 rounded">
                모두 펼치기
              </button>
            </div>
            <div class="tree-search">
              <input type="text" placeholder="트리 검색..." id="tree-search-input">
            </div>
            <div id="tree-container" class="space-y-1">
              ${generateTreeItems(data)}
            </div>
          </div>
        `;
      }
      
      function generateTreeItems(items, level = 0) {
        return items.map(item => {
          const hasChildren = item.children && item.children.length > 0;
          const indent = level * 20;
          const status = item.status || '';
          
          return `
            <div class="tree-item ${status}" data-id="${item.id}" style="margin-left: ${indent}px;">
              <div class="tree-content">
                ${hasChildren ? `
                  <span class="tree-toggle" id="toggle-${item.id}">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                ` : '<span style="width: 16px; margin-right: 8px;"></span>'}
                <span class="tree-icon">
                  ${getTreeIcon(item.type)}
                </span>
                <span class="tree-label">${item.label}</span>
                ${item.badge ? `<span class="tree-badge ${status}">${item.badge}</span>` : ''}
                ${status === 'new' ? '<span class="status-indicator new">NEW</span>' : ''}
                ${status === 'updated' ? '<span class="status-indicator updated">UPD</span>' : ''}
              </div>
              ${hasChildren ? `
                <div class="tree-children collapsed" id="children-${item.id}">
                  ${generateTreeItems(item.children, level + 1)}
                </div>
              ` : ''}
            </div>
          `;
        }).join('');
      }
      
      function getTreeIcon(type) {
        const icons = {
          'folder': `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 7v10a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-5l-2-2H5a2 2 0 0 0-2 2z" stroke="currentColor" stroke-width="2"/>
          </svg>`,
          'file': `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
          </svg>`,
          'pdf': `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" stroke="currentColor" stroke-width="2"/>
            <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2"/>
            <path d="M9 13h6" stroke="currentColor" stroke-width="2"/>
            <path d="M9 17h6" stroke="currentColor" stroke-width="2"/>
            <path d="M9 9h1" stroke="currentColor" stroke-width="2"/>
          </svg>`,
          'image': `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
            <path d="M21 15l-3.086-3.086a2 2 0 0 0-2.828 0L6 21" stroke="currentColor" stroke-width="2"/>
          </svg>`,
          'default': `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2"/>
          </svg>`
        };
        return icons[type] || icons.default;
      }
      
      // 트리 아이템 토글
      function toggleTreeItem(id) {
        const toggle = document.getElementById(`toggle-${id}`);
        const children = document.getElementById(`children-${id}`);
        
        if (toggle && children) {
          const isExpanded = toggle.classList.contains('expanded');
          
          if (isExpanded) {
            toggle.classList.remove('expanded');
            children.classList.remove('expanded');
            children.classList.add('collapsed');
          } else {
            toggle.classList.add('expanded');
            children.classList.remove('collapsed');
            children.classList.add('expanded');
          }
        }
      }
      
      // 트리 검색 기능
      function setupTreeSearch() {
        const searchInput = document.getElementById('tree-search-input');
        if (!searchInput) return;
        
        const debouncedTreeFilter = debounce((query) => {
          const treeItems = document.querySelectorAll('.tree-item');
          treeItems.forEach(item => {
            const label = item.querySelector('.tree-label').textContent.toLowerCase();
            const matches = label.includes(query);
            
            if (query === '') {
              item.style.display = 'block';
              item.style.opacity = '1';
            } else {
              item.style.display = matches ? 'block' : 'none';
              item.style.opacity = matches ? '1' : '0.3';
            }
          });
        }, 300);

        searchInput.addEventListener('input', (e) => {
          debouncedTreeFilter(e.target.value.toLowerCase());
        });
      }
      
      // 모두 펼치기/접기
      function toggleAllTreeItems() {
        const expandBtn = document.getElementById('expand-all');
        const toggles = document.querySelectorAll('.tree-toggle');
        const children = document.querySelectorAll('.tree-children');
        
        if (!expandBtn) return;
        
        const isAllExpanded = Array.from(toggles).every(t => t.classList.contains('expanded'));
        
        if (isAllExpanded) {
          // 모두 접기
          toggles.forEach(t => t.classList.remove('expanded'));
          children.forEach(c => {
            c.classList.remove('expanded');
            c.classList.add('collapsed');
          });
          expandBtn.textContent = '모두 펼치기';
        } else {
          // 모두 펼치기
          toggles.forEach(t => t.classList.add('expanded'));
          children.forEach(c => {
            c.classList.remove('collapsed');
            c.classList.add('expanded');
          });
          expandBtn.textContent = '모두 접기';
        }
      }
      
      // 전역 함수들
      window.removeFilter = removeFilter;
      window.clearAllFilters = clearAllFilters;
      window.performSearch = performSearch;
      window.showToast = showToast;
      window.toggleTreeItem = toggleTreeItem;
      window.toggleAllTreeItems = toggleAllTreeItems;
      window.handleTreeClick = handleTreeClick;
      window.clearExistingToasts = clearExistingToasts;

      // ---- Pages ----
      function renderHome(){
        app.innerHTML = `
          <div class=\"grid md:grid-cols-[260px,1fr] gap-6\">\n            ${leftPanelHTML()}\n            <section class=\"space-y-6\">\n              ${filterBarHTML(true)}\n              ${quickLinkTableHTML()}\n              <div class=\"bg-white border border-slate-200 rounded-3xl p-6 text-sm text-slate-600\">\n                <div class=\"font-medium mb-2\">결과/뷰어 자리(더미)</div>\n                <p>이 영역은 목록 및 문서 뷰어가 들어가는 자리입니다. 실제 문서는 포함하지 않으며, UI 흐름만 체험하도록 구성됩니다.</p>\n              </div>\n            </section>\n          </div>`;
        setupPartSearch();
        
        // 첫화면에서도 연식에 따른 배터리 자동 설정
        setTimeout(() => {
          const yearSelect = document.getElementById('yearSelect');
          if (yearSelect) {
            const currentYear = parseInt(yearSelect.value) || 2024;
            updateChemistryByYear(currentYear);
            
            // 연식 변경 이벤트
            yearSelect.addEventListener('change', (e) => {
              const selectedYear = parseInt(e.target.value);
              updateChemistryByYear(selectedYear);
            });
          }
        }, 100);
      }
      function renderSection(title){
        const gate = requireAuthUI(); if (gate){ app.innerHTML = gate; return; }
        
        // 페이지별 트리 데이터 정의
        const treeData = getTreeDataByTitle(title);
        
        app.innerHTML = `
          <section class=\"space-y-6\">\n            <div class=\"flex items-center justify-between\">\n              <h1 class=\"text-2xl font-bold\">${title}</h1>\n              <div class=\"text-sm text-slate-500\">UI 전용 • 더미 데이터</div>\n            </div>\n            ${filterBarHTML(false)}\n            <div class=\"grid md:grid-cols-[300px,1fr] gap-6\">\n              ${createTreeHTML('문서 목록', treeData)}\n              ${pdfViewerHTML()}\n            </div>\n          </section>`;
        
        // left panel search is not present on inner sections, but top filter uses same IDs so setupPartSearch still wires.
        setupPartSearch();
        
        // 트리 기능 초기화
        setTimeout(() => {
          setupTreeSearch();
          setupTreeEventHandlers();
        }, 100);
      }
      
      function getTreeDataByTitle(title) {
        const dataMap = {
          '정비지침서': [
            {
              id: 'shop-1',
              label: '엔진 시스템',
              type: 'folder',
              badge: '12',
              status: 'updated',
              children: [
                { id: 'shop-1-1', label: '엔진 오일 교체', type: 'pdf', badge: '3', status: 'new' },
                { id: 'shop-1-2', label: '에어 필터 점검', type: 'pdf', badge: '2', status: 'updated' },
                { id: 'shop-1-3', label: '점화 플러그 교체', type: 'pdf', badge: '1' },
                { id: 'shop-1-4', label: '연료 필터 교체', type: 'pdf', badge: '2', status: 'new' },
                { id: 'shop-1-5', label: '냉각수 교체', type: 'pdf', badge: '1' }
              ]
            },
            {
              id: 'shop-2',
              label: '전기 시스템',
              type: 'folder',
              badge: '8',
              status: 'updated',
              children: [
                { id: 'shop-2-1', label: '배터리 점검', type: 'pdf', badge: '2' },
                { id: 'shop-2-2', label: '발전기 점검', type: 'pdf', badge: '1' },
                { id: 'shop-2-3', label: '스타터 모터', type: 'pdf', badge: '1', status: 'new' },
                { id: 'shop-2-4', label: '퓨즈 박스 점검', type: 'pdf', badge: '1' }
              ]
            },
            {
              id: 'shop-3',
              label: '제동 시스템',
              type: 'folder',
              badge: '15',
              children: [
                { id: 'shop-3-1', label: '브레이크 패드 교체', type: 'pdf', badge: '4', status: 'updated' },
                { id: 'shop-3-2', label: '브레이크 오일 교체', type: 'pdf', badge: '2' },
                { id: 'shop-3-3', label: 'ABS 시스템', type: 'pdf', badge: '3', status: 'new' },
                { id: 'shop-3-4', label: '브레이크 라인', type: 'pdf', badge: '2' }
              ]
            },
            {
              id: 'shop-4',
              label: '서스펜션 시스템',
              type: 'folder',
              badge: '10',
              status: 'new',
              children: [
                { id: 'shop-4-1', label: '샤시 점검', type: 'pdf', badge: '2' },
                { id: 'shop-4-2', label: '스프링 교체', type: 'pdf', badge: '1' },
                { id: 'shop-4-3', label: '댐퍼 교체', type: 'pdf', badge: '1' }
              ]
            }
          ],
          '전장회로도': [
            {
              id: 'etm-1',
              label: '전원 시스템',
              type: 'folder',
              badge: '6',
              status: 'updated',
              children: [
                { id: 'etm-1-1', label: '메인 퓨즈 박스', type: 'image', badge: '1' },
                { id: 'etm-1-2', label: '배터리 연결도', type: 'image', badge: '1' },
                { id: 'etm-1-3', label: '발전기 회로', type: 'image', badge: '1', status: 'new' },
                { id: 'etm-1-4', label: '스타터 회로', type: 'image', badge: '1' }
              ]
            },
            {
              id: 'etm-2',
              label: '조명 시스템',
              type: 'folder',
              badge: '4',
              children: [
                { id: 'etm-2-1', label: '헤드램프 회로', type: 'image', badge: '1' },
                { id: 'etm-2-2', label: '내부 조명 회로', type: 'image', badge: '1' },
                { id: 'etm-2-3', label: '방향지시등', type: 'image', badge: '1' },
                { id: 'etm-2-4', label: '브레이크등', type: 'image', badge: '1' }
              ]
            },
            {
              id: 'etm-3',
              label: '제어 시스템',
              type: 'folder',
              badge: '8',
              status: 'new',
              children: [
                { id: 'etm-3-1', label: 'ECU 회로', type: 'image', badge: '2' },
                { id: 'etm-3-2', label: '센서 회로', type: 'image', badge: '3' },
                { id: 'etm-3-3', label: '액추에이터 회로', type: 'image', badge: '3' }
              ]
            }
          ],
          'DTC 매뉴얼': [
            {
              id: 'dtc-1',
              label: '엔진 DTC',
              type: 'folder',
              badge: '25',
              status: 'updated',
              children: [
                { id: 'dtc-1-1', label: 'P0000-P0999', type: 'file', badge: '10' },
                { id: 'dtc-1-2', label: 'P1000-P1999', type: 'file', badge: '8' },
                { id: 'dtc-1-3', label: 'P2000-P2999', type: 'file', badge: '7', status: 'new' }
              ]
            },
            {
              id: 'dtc-2',
              label: '전송 DTC',
              type: 'folder',
              badge: '12',
              children: [
                { id: 'dtc-2-1', label: 'P0700-P0799', type: 'file', badge: '5' },
                { id: 'dtc-2-2', label: 'P0800-P0899', type: 'file', badge: '4' },
                { id: 'dtc-2-3', label: 'P0900-P0999', type: 'file', badge: '3', status: 'new' }
              ]
            },
            {
              id: 'dtc-3',
              label: '차체 DTC',
              type: 'folder',
              badge: '18',
              status: 'new',
              children: [
                { id: 'dtc-3-1', label: 'B0000-B0999', type: 'file', badge: '8' },
                { id: 'dtc-3-2', label: 'C0000-C0999', type: 'file', badge: '10' }
              ]
            }
          ],
          '차체매뉴얼': [
            {
              id: 'body-1',
              label: '외장 부품',
              type: 'folder',
              badge: '18',
              status: 'updated',
              children: [
                { id: 'body-1-1', label: '범퍼 교체', type: 'pdf', badge: '3' },
                { id: 'body-1-2', label: '도어 패널', type: 'pdf', badge: '2' },
                { id: 'body-1-3', label: '후드 교체', type: 'pdf', badge: '2', status: 'new' },
                { id: 'body-1-4', label: '트렁크 리드', type: 'pdf', badge: '1' },
                { id: 'body-1-5', label: '휀더 교체', type: 'pdf', badge: '2' }
              ]
            },
            {
              id: 'body-2',
              label: '내장 부품',
              type: 'folder',
              badge: '14',
              children: [
                { id: 'body-2-1', label: '시트 교체', type: 'pdf', badge: '2' },
                { id: 'body-2-2', label: '대시보드', type: 'pdf', badge: '1' },
                { id: 'body-2-3', label: '도어 트림', type: 'pdf', badge: '2' },
                { id: 'body-2-4', label: '루프 라이닝', type: 'pdf', badge: '1', status: 'new' }
              ]
            },
            {
              id: 'body-3',
              label: '유리 및 미러',
              type: 'folder',
              badge: '12',
              status: 'new',
              children: [
                { id: 'body-3-1', label: '윈드실드 교체', type: 'pdf', badge: '2' },
                { id: 'body-3-2', label: '사이드 미러', type: 'pdf', badge: '1' },
                { id: 'body-3-3', label: '리어 미러', type: 'pdf', badge: '1' }
              ]
            }
          ],
          '와이어링 커넥터': [
            {
              id: 'wiring-1',
              label: '엔진룸 커넥터',
              type: 'folder',
              badge: '32',
              status: 'updated',
              children: [
                { id: 'wiring-1-1', label: 'ECU 커넥터', type: 'image', badge: '5' },
                { id: 'wiring-1-2', label: '센서 커넥터', type: 'image', badge: '8' },
                { id: 'wiring-1-3', label: '액추에이터 커넥터', type: 'image', badge: '6', status: 'new' },
                { id: 'wiring-1-4', label: '퓨즈 박스 커넥터', type: 'image', badge: '4' },
                { id: 'wiring-1-5', label: '릴레이 커넥터', type: 'image', badge: '3' }
              ]
            },
            {
              id: 'wiring-2',
              label: '실내 커넥터',
              type: 'folder',
              badge: '24',
              children: [
                { id: 'wiring-2-1', label: '계기판 커넥터', type: 'image', badge: '3' },
                { id: 'wiring-2-2', label: '스위치 커넥터', type: 'image', badge: '6' },
                { id: 'wiring-2-3', label: '오디오 커넥터', type: 'image', badge: '4' },
                { id: 'wiring-2-4', label: '공조 커넥터', type: 'image', badge: '3' }
              ]
            },
            {
              id: 'wiring-3',
              label: '외장 커넥터',
              type: 'folder',
              badge: '16',
              status: 'new',
              children: [
                { id: 'wiring-3-1', label: '조명 커넥터', type: 'image', badge: '5' },
                { id: 'wiring-3-2', label: '센서 커넥터', type: 'image', badge: '4' },
                { id: 'wiring-3-3', label: '안테나 커넥터', type: 'image', badge: '2' }
              ]
            }
          ]
        };
        
        return dataMap[title] || [
          { id: 'default-1', label: '기본 섹션 1', type: 'folder', badge: '3' },
          { id: 'default-2', label: '기본 섹션 2', type: 'folder', badge: '2' },
          { id: 'default-3', label: '기본 섹션 3', type: 'folder', badge: '1' }
        ];
      }
      
      function setupTreeEventHandlers() {
        // 기존 이벤트 리스너 제거 (중복 방지)
        const existingExpandBtn = document.getElementById('expand-all');
        if (existingExpandBtn) {
          existingExpandBtn.removeEventListener('click', toggleAllTreeItems);
          existingExpandBtn.addEventListener('click', toggleAllTreeItems);
        }
        
        // 트리 컨테이너에 이벤트 위임 사용
        const treeContainer = document.getElementById('tree-container');
        if (treeContainer) {
          // 기존 이벤트 리스너 제거
          treeContainer.removeEventListener('click', handleTreeClick);
          treeContainer.addEventListener('click', handleTreeClick);
        }
      }
      
      // 트리 클릭 이벤트 핸들러 (이벤트 위임)
      function handleTreeClick(e) {
        e.stopPropagation(); // 이벤트 버블링 방지
        
        const treeItem = e.target.closest('.tree-item');
        if (!treeItem) return;
        
        const toggle = e.target.closest('.tree-toggle');
        const treeContent = e.target.closest('.tree-content');
        
        // 하위 항목이 있는 경우 확장/축소 처리
        const hasChildren = treeItem.querySelector('.tree-children');
        if (hasChildren) {
          const itemId = treeItem.dataset.id;
          toggleTreeItem(itemId);
          
          // 토글 애니메이션 효과
          const toggleElement = treeItem.querySelector('.tree-toggle');
          if (toggleElement) {
            toggleElement.style.transform = toggleElement.classList.contains('expanded') ? 'rotate(90deg)' : 'rotate(0deg)';
          }
        }
        
        // 항목 선택 처리 (하위 항목이 없거나 확장/축소 후에도 실행)
        if (treeContent) {
          // 활성 상태 토글
          const allTreeItems = document.querySelectorAll('.tree-item');
          allTreeItems.forEach(item => item.classList.remove('active'));
          treeItem.classList.add('active');
          
          // 아이템 정보 표시
          const label = treeItem.querySelector('.tree-label').textContent;
          const itemId = treeItem.dataset.id;
          const status = treeItem.classList.contains('new') ? ' (신규)' : 
                        treeItem.classList.contains('updated') ? ' (업데이트)' : '';
          
          // 이전 토스트 제거
          clearExistingToasts();
          
          // 새 토스트 표시
          showToast(`${label} 선택됨${status}`, 'info');
          
          // 선택된 아이템에 하이라이트 효과
          treeItem.style.animation = 'none';
          setTimeout(() => {
            treeItem.style.animation = 'treeItemSelect 0.3s ease';
          }, 10);
        }
      }
      
      // 기존 토스트 제거 함수
      function clearExistingToasts() {
        const existingToasts = document.querySelectorAll('.toast');
        existingToasts.forEach(toast => {
          toast.classList.remove('show');
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        });
      }
      function renderPrivacy(){
        app.innerHTML = `
          <section class=\"space-y-6\">\n            <h1 class=\"text-2xl font-bold\">개인정보처리방침</h1>\n            <article class=\"bg-white border border-slate-200 rounded-3xl p-6 text-sm leading-6 whitespace-pre-wrap\">\n우리 헌법은 국민의 기본권인 사생활의 비밀과 자유 및 통신의 비밀을 보장하고 있으므로 도/감청 등에의한 개인 정보 및 사생활의 은밀한 탐지는 원칙적으로 불법입니다. 그러나 우리 사회에 횡행하는 불법 도청, 통신상의 정보 유출로 인하여 심각한 인권 침해가 나타나고 있고 국민 개개인의 자유로운 생활형성이 위협 받고 있습니다. 이러한 기본권 침해의 소지를 원천적으로 제거함으로써 (주)이브이케이엠씨회원의 프라이버시를 철저히 보호하여 정보화 사회에서의 통신의 자유를 보장하고자 아래와 같이 개인정보보호정책을 명시합니다. (주)이브이케이엠씨 개인정보보호정책은 정부의 법률 및 지침의 변경과 (주)이브이케이엠씨의 정책 변화에 따라 변경될 수 있습니다. 회원님께서는 (주)이브이케이엠씨 사이트 방문 시에 수시로 확인하시기 바랍니다.\n\n1. 개인정보의 수집목적 및 이용\n(주)이브이케이엠씨 회원님 개인의 정보를 수집하는 목적은 (주)이브이케이엠씨 사이트를 통하여 회원님께 최적의 맞춤화된 서비스를 제공해드리기 위한 것입니다. (주)이브이케이엠씨는 각종의 컨텐츠를 무료 및 유료로 서비스해 드리고 있습니다. 이때 회원님께서 제공해주신 개인정보를 바탕으로 회원님께 보다 더 유용한 정보를 선택적으로 제공하는 것이 가능하게 됩니다.\n(주)이브이케이엠씨는 각종 서비스를 제공하기 위해서 광고를 게재합니다. 이때에도 회원님 개인에 대한 정보를 바탕으로 좀더 유용한 정보로서의 가치가 있는 광고를 선별적으로 전달할 수 있게 됩니다.\n\n2. 수집하는 개인정보 항목 및 수집방법\n(주)이브이케이엠씨는 최초 회원가입을 하실 때 서비스 제공을 위해 가장 필수적인 개인정보를 받고 있습니다. 회원가입 시에 받는 정보는 회원님의 아이디, 생년월일, 별명, 결혼, 추천인 아이디, 패스워드, 성명, e-mail, 주소, 전화번호, 휴대전화 등입니다.\n이 이외에 특정 서비스를 제공하기 위하여 추가적인 정보제공을 요청하고 있습니다.\n실명확인을 위한 휴대폰번호, 기타 서비스제공에 필요한 추가정보의 기재를 요청하게 됩니다. 또한 설문조사나 이벤트 시에 집단적인 통계분석을 위해서나 경품발송을 위한 목적으로도 개인정보 기재를 요청할 수 있습니다. 이때에도 기입하신 정보는 해당서비스 제공이나 회원님께 사전에 밝힌 목적 이외의 다른 어떠한 목적으로도 사용되지 않음을 알려드립니다.\n\n3. 개인정보의 보유 및 폐기\n귀하가 (주)이브이케이엠씨 의 회원으로서 (주)이브이케이엠씨 가 제공하는 서비스를 받는 동안 회원님의 개인정보는 (주)이브이케이엠씨에서 계속 보유하며 서비스 제공을 위해 이용하게 됩니다. 다만 (주)이브이케이엠씨 의 회원이 아래의 '7. 자신의 개인정보 열람, 정정 및 삭제'에서 설명한 절차에 따라 ID를 삭제하거나 가입해지를 요청한 경우와 회원님께 사전에 알려드린 개인정보를 제공받은 목적이 달성된 경우에 수집된 개인의 정보는 재생할 수 없는 방법에 의하여 하드디스크에서 완전히 삭제되며 어떠한 용도로도 열람 또는 이용할 수 없도록 처리됩니다.\n\n4. 개인정보의 제공 및 공유\n원칙적으로 (주)이브이케이엠씨 회원님의 개인정보를 타인 또는 타기업·기관에 공개하지 않습니다. 다만 회원님이 공개에 동의한 경우 또는 (주)이브이케이엠씨 의 서비스 이용약관을 위배하는 사람이나 (주)이브이케이엠씨 의 서비스를 이용하여 타인에게 법적인 피해를 주거나 미풍양속을 해치는 행위를 한 사람 등에게 법적인 조치를 취하기 위하여 개인정보를 공개해야 한다고 판단되는 충분한 근거가 있는 경우는 예외로 합니다.\n(주)이브이케이엠씨는 보다 나은 서비스 제공을 위해 회원님의 개인정보를 비즈니스 파트너와 공유할 수 있습니다. 이 경우에도 정보수집 또는 정보제공 이전에 회원님께 비즈니스 파트너가 누구인지, 어떤 정보가 왜 필요한지, 그리고 언제까지 어떻게 보호/관리되는지 알려드리고 동의를 구하는 절차를 거치게 되며, 회원님께서 동의하지 않는 경우에는 추가적인 정보를 수집하거나 비즈니스 파트너와 공유하지 않습니다.\n성별, 연령별 기타 특정 조건의 집단에 대한 광고 게재 및 발송 시(예, 20대 여자)에도 회원님 개인의 정보는 광고를 의뢰한 개인이나 단체에 제공되지 않습니다. 기타 통계처리, 학술연구, 시장조사를 위하여 필요한 경우에는 특정한 개인을 식별할 수 없는 형태로만 정보가 제공됩니다.\n\n5. 쿠키(cookie)의 운용 및 활용\n회원님 개개인에게 개인화되고(personalized) 맞춤화된(customized) 서비스를 제공하기 위해서 (주)이브이케이엠씨는 회원님의 정보를 저장하고 수시로 불러오는 '쿠키(cookie)'를 사용합니다. 쿠키는 웹사이트를 운영하는데 이용되는 서버가 사용자의 브라우저에게 보내는 조그마한 데이터 꾸러미로 회원님 컴퓨터의 하드디스크에 저장됩니다.\n회원님께서 (주)이브이케이엠씨 에 접속한 후 로그인(log-in)하여 개인화된 서비스나 맞춤화된 서비스를 이용하시기 위해서는 쿠키를 허용하여야 합니다. (주)이브이케이엠씨는 회원님께 적합하고 보다 유용한 서비스를 제공하기 위해서 쿠키를 이용하여 회원님의 아이디에 대한 정보를 찾아냅니다.\n(주)이브이케이엠씨에 접속하는 이용자의 브라우저에 고유한 쿠키를 부여함으로써 회원 및 비회원들의 (주)이브이케이엠씨사이트 이용빈도나 전체 이용자수 등과 같은 이용자 규모를 파악하는데도 이용됩니다. 또한 (주)이브이케이엠씨쇼핑에서 상품구매 시 인증을 위해서나 상품구매를 돕기 위해서도 쿠키 정보를 이용하며, 기타 이벤트나 설문조사에서 회원님의 참여 경력을 확인하기 위해서 쿠키를 이용하게 됩니다.\n쿠키를 이용하여 회원님께서 방문한 (주)이브이케이엠씨서비스의 방문 및 이용형태를 파악함으로써 더 유용하고 이용하기 편리한 서비스를 만들어 제공할 수 있게 됩니다. 회원님은 쿠키에 대한 선택권을 가지고 있습니다. 회원님의 웹브라우저에서 옵션을 선택함으로써 모든 쿠키를 허용하거나, 쿠키가 저장될 때마다 확인을 거치거나, 모든 쿠키의 저장을 거부할 수 있습니다. 단, 쿠키의 저장을 거부하실 경우 로그인이 필요한 (주)이브이케이엠씨의 모든 서비스는 이용하실 수 없게됩니다.\n\n6. 개인정보보호를 위한 기술적/제도적 관리\n회원님의 개인정보는 비밀번호에 의해 보호되고 있습니다. 회원님 계정의 비밀번호는 오직 본인만이 알 수 있으며, 개인정보의 확인 및 변경도 비밀번호를 알고 있는 본인에 의해서만 가능합니다. 따라서 회원님의 비밀번호는 누구에게도 알려주면 안됩니다. 또한 작업을 마치신 후에는 로그아웃(log-out)하시고 웹브라우저를 종료하는 것이 바람직합니다. 특히 다른 사람과 컴퓨터를 공유하여 사용하거나 공공장소에서 이용한 경우 개인정보가 다른 사람에게 알려지는 것을 막기 위해서 이와 같은 절차가 더욱 필요하다고 하겠습니다.\n(주)이브이케이엠씨는 백신프로그램을 이용하여 컴퓨터바이러스에 의한 피해를 방지하기 위한 조치를 취하고 있습니다. 백신프로그램은 주기적으로 업데이트 되며 갑작스런 바이러스가 출현할 경우 백신이 나오는 즉시 이를 제공함으로써 개인정보가 훼손되는 것을 방지하고 있습니다.\n해킹 등에 의해 회원의 개인정보가 유출되는 것을 막기 위해 현재 외부로부터의 침입을 차단하는 장치를 이용하여 외부로부터의 공격, 해킹 등을 막고 있으며, 각 서버마다 침입탐지시스템을 설치하여 24시간 침입을 감시하고 있습니다. 기타 회원 개인정보의 훼손에 대비해서 시스템과 데이터를 백업하여 만약의 사태에 대비하고 있습니다.\n(주)이브이케이엠씨는 개인정보 취급 직원을 최소한으로 제한하고 담당직원에 대한 수시 교육을 통하여 본 정책의 준수를 강조하고 있으며, 감사위원회의 감사를 통하여 본 정책의 이행사항 및 담당직원의 준수여부를 확인하여 문제가 발견될 경우 바로 시정조치하고 있습니다.\n\n7. 자신의 개인정보 열람, 정정 및 삭제\n회원님은 언제든지 등록되어 있는 회원님의 개인정보를 열람하거나 정정하실 수 있으며, 아이디(ID) 삭제를 요청하실 수 있습니다.\n개인정보와 관련하여 불만이나 의견이 있으신 분은 개인정보 관리담당자에게 메일 (help@(주)이브이케이엠씨.co.kr) 로 의견을 주시면 접수 즉시 조치하고 처리결과를 통보해 드리겠습니다.\n\n8. 어린이의 개인정보보호\n만14세 미만의 어린이는 자신에 대한 정보를 다른 사람에게 함부로 보내면 안되며, 보내기 전에 반드시 부모님의 허락을 받아야 합니다.\n회원님 계정의 비밀번호에 대한 보안을 유지할 책임은 회원님 자신에게 있습니다. (주)이브이케이엠씨에서 메일 또는 기타 방법으로 회원님께 비밀번호를 질문하는 경우는 절대 없으므로 어떠한 경우에도 비밀번호를 알려주지 마십시오. 로그온(log-on)한 상태에서는 주위의 다른 사람에게 개인정보가 유출되지 않도록 특별히 주의를 기울이시기 바랍니다.\n\n이상의 변경된 (주)이브이케이엠씨 의 개인정보보호정책은 2007년 01월 01일부터 시행합니다.\n            </article>\n          </section>`;
      }
      function renderNotFound(){
        app.innerHTML = `
          <div class=\"bg-white border border-slate-200 rounded-3xl p-12 text-center\">\n            <div class=\"text-3xl font-bold mb-2\">404</div>\n            <p class=\"text-slate-600 mb-6\">요청한 페이지를 찾을 수 없습니다.</p>\n            <a href=\"#/home\" class=\"px-4 py-2 rounded-xl border\">홈으로</a>\n          </div>`;
      }

      function updateAuthState() {
        const s = session.get();
        const authButtons = document.getElementById('auth-buttons');
        const userMenu = document.getElementById('user-menu');
        const userNameEl = document.getElementById('user-name');

        if (s && authButtons && userMenu && userNameEl) {
            authButtons.classList.add('hidden');
            userMenu.classList.remove('hidden');
            userMenu.classList.add('flex');
            userNameEl.textContent = s.name;
        } else if (authButtons && userMenu) {
            authButtons.classList.remove('hidden');
            userMenu.classList.add('hidden');
            userMenu.classList.remove('flex');
        }
      }

      // ---- Static handlers / session / brand ----
      function attachStaticHandlers(){
        const loginModal = document.getElementById('login-modal');
        const signupModal = document.getElementById('signup-modal');
        function _openLogin(){ loginModal?.classList.remove('hidden'); loginModal?.classList.add('flex'); }
        function _openSignup(){ signupModal?.classList.remove('hidden'); signupModal?.classList.add('flex'); }
        function _closeModals(){ [loginModal, signupModal].forEach(m=> m?.classList.add('hidden')); [loginModal, signupModal].forEach(m=> m?.classList.remove('flex')); }
        window.openLogin = _openLogin; window.openSignup = _openSignup;
        document.getElementById('open-login')?.addEventListener('click', _openLogin);
        document.getElementById('open-signup')?.addEventListener('click', _openSignup);
        document.querySelectorAll('[data-close]')?.forEach(b=> b.addEventListener('click', _closeModals));
        document.getElementById('login-form')?.addEventListener('submit', (e)=>{
          e.preventDefault(); const fd=new FormData(e.currentTarget);
          const email=String(fd.get('email')||'').trim(); const password=String(fd.get('password')||'');
          const found=users.findByEmail(email); if(!found||found.password!==password){ alert('일치하는 계정이 없거나 비밀번호가 틀렸습니다. (UI용)'); return; }
          session.set({ email: found.email, name: found.name||found.email.split('@')[0] });
          _closeModals();
          updateAuthState();
          navigate('/shop');
          router();
        });
        document.getElementById('signup-form')?.addEventListener('submit', (e)=>{
          e.preventDefault(); const fd=new FormData(e.currentTarget);
          const name=String(fd.get('name')||'').trim(); const email=String(fd.get('email')||'').trim(); const password=String(fd.get('password')||'');
          if (users.findByEmail(email)) { alert('이미 등록된 이메일입니다. (UI용)'); return; }
          users.add({ name, email, password });
          session.set({ email, name });
          _closeModals();
          updateAuthState();
          navigate('/shop');
          router();
        });
        document.getElementById('mobile-menu-btn')?.addEventListener('click', (ev)=>{ const n=document.getElementById('mobile-nav'); n?.classList.toggle('hidden'); ev.currentTarget.setAttribute('aria-expanded', n?.classList.contains('hidden')? 'false':'true'); });
        const yearEl = document.getElementById('year'); if (yearEl) { yearEl.textContent = String(new Date().getFullYear()); }

        document.getElementById('logout-btn')?.addEventListener('click', () => {
            session.clear();
            updateAuthState();
            navigate('/home');
            router();
            showToast('로그아웃되었습니다.', 'info');
        });

        // link clicks (hash) - allow middle click default
        document.body.addEventListener('click', (e)=>{
          const a = e.target.closest('a[data-link]');
          if (!a) return; // not our link
          const href = a.getAttribute('href')||'';
          if (href.startsWith('#/')) { e.preventDefault(); window.location.hash = href; }
        });
      }
      function setLogoSrc(src){ const img=document.getElementById('brand-logo'); const fb=document.getElementById('brand-fallback'); if(!src) return; img.src=src; img.classList.remove('hidden'); fb.classList.add('hidden'); }
      function initBrand(){
        document.querySelectorAll('.brand-name').forEach(el=>{ el.textContent = window.__BRAND__?.name || 'EVKMC A/S'; });
        if (window.__BRAND__.logoUrl) { setLogoSrc(window.__BRAND__.logoUrl); }
        else { const saved = localStorage.getItem('brandLogoDataUrl'); if (saved) setLogoSrc(saved); }
      }



      // ---- PDF viewer wiring ----
      function setupPdfViewer(){
        const fileInput = document.getElementById('pdf-file');
        const btnOpen   = document.getElementById('btn-open-pdf');
        const btnClear  = document.getElementById('btn-clear-pdf');
        const iframe    = document.getElementById('pdfFrame');
        const placeholder = document.getElementById('pdf-placeholder');
        const dropzone  = document.getElementById('pdf-dropzone');
        const recentBox = document.getElementById('recent-pdfs');
        if (!fileInput || !btnOpen || !iframe || !placeholder || !dropzone || !recentBox) return;

        function showPlaceholder(show){ placeholder.classList.toggle('hidden', !show); }
        function openBlob(file){ const url = URL.createObjectURL(file); iframe.src = url; showPlaceholder(false); addRecent({ name: file.name, url, isBlob: true }); }
        function openPath(path){ iframe.src = path; showPlaceholder(false); addRecent({ name: path.split('/').pop(), url: path, isBlob: false }); }
        function clearPdf(){ iframe.src = ''; showPlaceholder(true); }

        // expose to global so parts search can call it
        window.__openPdfPath = openPath;

        const RECENTS_KEY = 'demo_recent_pdfs_v1';
        function getRecents(){ return JSON.parse(localStorage.getItem(RECENTS_KEY)||'[]'); }
        function addRecent(item){ const list = getRecents().filter(x=>x.url!==item.url); list.unshift({ ...item, ts: Date.now() }); localStorage.setItem(RECENTS_KEY, JSON.stringify(list.slice(0,8))); renderRecents(); }
        function renderRecents(){ const list = getRecents(); recentBox.innerHTML = list.map(it=>`<button class="px-2.5 py-1.5 text-xs rounded-lg border" data-open="${encodeURIComponent(it.url)}" data-blob="${it.isBlob?1:0}">${it.name}</button>`).join(''); }

        btnOpen.onclick = ()=> fileInput.click();
        fileInput.onchange = (e)=>{ const f=e.target.files?.[0]; if (f) openBlob(f); };
        btnClear.onclick = clearPdf;

        // Drag & Drop
        ['dragenter','dragover'].forEach(ev=> dropzone.addEventListener(ev, (e)=>{ e.preventDefault(); dropzone.classList.add('ring-2','ring-brand-dark'); }));
        ;['dragleave','drop'].forEach(ev=> dropzone.addEventListener(ev, (e)=>{ e.preventDefault(); dropzone.classList.remove('ring-2','ring-brand-dark'); }));
        dropzone.addEventListener('drop', (e)=>{
          const f = e.dataTransfer?.files?.[0];
          if (f && f.type==='application/pdf') openBlob(f);
        });

        // Recents click
        recentBox.addEventListener('click', (e)=>{
          const b = e.target.closest('button[data-open]'); if(!b) return;
          const url = decodeURIComponent(b.getAttribute('data-open'));
          openPath(url);
        });

        renderRecents();
        
        // 연식 선택 시 배터리 자동 설정
        const yearSelect = document.getElementById('yearSelect');
        if (yearSelect) {
          // 초기 설정
          const currentYear = parseInt(yearSelect.value) || 2024;
          updateChemistryByYear(currentYear);
          
          // 연식 변경 이벤트
          yearSelect.addEventListener('change', (e) => {
            const selectedYear = parseInt(e.target.value);
            updateChemistryByYear(selectedYear);
          });
        }
      }

      // ---- Boot ----
      function boot(){
        initBrand();
        attachStaticHandlers();
        updateAuthState();
        window.addEventListener('hashchange', router);
        router();
      }

      // start
      boot();
    })();
  }
  </script>
</body>
</html>
